<!DOCTYPE html>
<html lang="zh-Hans">
<head>
<title>汉字台式机〜P.C.</title>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta http-equiv="X-UA-Compatible" content="ie=edge">
<script src='Soma_1.00x\sessionData_xBeta.js' type='text/javascript'></script>
<script src='Soma_1.00x\synapse_xBeta.js' type='text/javascript'></script>
<script src='Soma_1.00x\ref_xBeta.js' type='text/javascript'></script>
<script src='RU_Keys.js' type='text/javascript'></script>


<!--<srcipt src='Google_API\settings_lang.js' type ='text/javascript'/>-->
<!--<script>src ='terminal_UI.js' type ='text/javascript'</script>-->


<script>
function expand(){
    try {
        var p = document.getElementById("insert");
        if(p.style.display === "none"){
            p.style.display = "block";
            document.getElementById("mod_Window").innerHTML = "✕"
        } else {
            p.style.display = "none";
            document.getElementById("mod_Window").innerHTML = "音译：EXPAND_☐"
        }
    
    } catch(error) {
        document.getElementById("commandPrompt").innerHTML = "Click [...] to begin dialog.";
    }
}

function collapse(){
    try {
        var p = document.getElementById("terminal-content");
        if(p.style.display === "none"){
            p.style.display = "block";
        } else {
            p.style.display = "none";
        }
    
    } catch(error) {
        document.getElementById("commandPrompt").innerHTML = "Click [...] to begin dialog.";
    }
}
</script>

<style>

tsl {
color: #b0c4de;

}

tsl:hover {
background-color: grey;
color: white;
}

data {
color: blue;
display: none;
}

.tsl {
display: none;

}

/* The Modal (background) */
.modal-tsl {
  display: none; /* Hidden by default */
  position: fixed; /* Stay in place */
  /*z-index: 1;  Sit on top */
  left: 0;
  top: 0;
  max-width: 100%; /* Full width */
  max-height: 100%; /* Full height */
  overflow: scroll;  /*Enable scroll if needed */
  background-color: black; /* Fallback color */
  background-color: rgba(0,0,0,0.4); /* Black w/ opacity */
  -webkit-animation-name: fadeIn; /* Fade in the background */
  -webkit-animation-duration: 0.4s;
  animation-name: fadeIn;
  animation-duration: 0.4s
}

/* Modal Content */
.modal-content-tsl {
  position: fixed;
  bottom: 0;
  background-color: black;
  color: white;
  width: 100%;
  max-height: 100%;
  -webkit-animation-name: slideIn;
  -webkit-animation-duration: 0.4s;
  animation-name: slideIn;
  animation-duration: 0.4s
}

/* The Close Button */
.close {
  color: white;
  float: right;
  font-size: 28px;
  font-weight: bold;
}

.close:hover,
.close:focus {
  color: #000;
  text-decoration: none;
  cursor: pointer;
}

.modal-header-tsl {
  padding: 2px 16px;
  background-color: #5cb85c;
  color: white;
}

.modal-body-tsl {
padding: 2px 16px;
color: white;
background-color: black;

}

.modal-footer-tsl {
  padding: 2px 16px;
  background-color: #5cb85c;
  color: white;
}

/* Add Animation */
@-webkit-keyframes slideIn {
  from {bottom: -300px; opacity: 0} 
  to {bottom: 0; opacity: 1}
}

@keyframes slideIn {
  from {bottom: -300px; opacity: 0}
  to {bottom: 0; opacity: 1}
}

@-webkit-keyframes fadeIn {
  from {opacity: 0} 
  to {opacity: 1}
}

@keyframes fadeIn {
  from {opacity: 0} 
  to {opacity: 1}
}

div.index {
width: 100%
height: 260px;
border: 1px;
padding: 5px 5px;
overflow: auto;
}/*style="height:260px;width:100%;border:1px solid #ccc;font:16px/26px Georgia, Garamond, Serif;overflow:auto;">*/

.result {
background-color: black;
border: none;
text-align: left;
font-size: 16;
font-family: "Lucida Console", "Courier New", monospace;

}

.node {
background-color: #000000;
  border: 1px;
  color: white;
  padding: 5px 5px;
  text-align: center;
  text-decoration: none;
  display: inline-block;
  font-size: 11px;
  margin: 4px 2px;
  cursor: pointer;
}
</style>

<script>
//const data_TSL = new Array();
//const keyword_TSL = new Array();
window.onload = function() {
   var tsl = document.getElementsByTagName('tsl');
    for(var i = 0; i < tsl.length; i++) {
        var txt = tsl[i];
        var zh = txt.getAttribute('data-id');
        var attr = txt.getAttribute('title');
        
        keyword_TSL.push(zh);
        data_TSL.push(attr); 
   }
}

function config(){
    
    var init = document.getElementById("userPrompt").value;
    var str = init.toString();
    var n;
    var p;
    var x = str.indexOf('*') + 1;
    var y = str.indexOf('【');
    var z = str.indexOf('】') + 1;
    
    var vocab = str.substring(x,z);
    var data_ID = str.substring(x,y);
    
    /*document.getElementById("log").innerHTML += "Result:<br>";
    document.getElementById("log").innerHTML += str.substring(x,z) + "<br>";
    document.getElementById("log").innerHTML += str.substring(x,y) + "<br>";*/
    
    
    var phrase = new Array();
    var compile = new Array();
    
    phrase = str.split('*');
    for (n=0; n < phrase.length; n++){
        var info = phrase[n];
        if(info === undefined){
            console.log("Initialize:");
        //insert [animation] ...
        } else {
        
            var parse = info.toString();
        }
    
        if (parse.includes("【")){
            
        var a = parse.indexOf('【');
        var b = parse.indexOf('】') + 1;
        var vocabHTML_copy = parse.substring(0, b); 
        var dataID_copy = parse.substring(0, a);
        var datagram = "<tsl data-id='" + dataID_copy + "' title='" + vocabHTML_copy + "'>" + dataID_copy + "</tsl>";
        document.getElementById("chatLog").innerHTML += datagram;
        
        } else {
        
           document.getElementById("chatLog").innerHTML += parse; 
        }  
    }
    
    var endStr = document.getElementById("chatLog").innerHTML;
    
    console.log(phrase);
    //console.log(compile);
    //alert(endStr);
    document.getElementById("chatLog").innerHTML =  endStr + " …… <br><br>";
    
}
</script>
</head>

<body style="background-color: black; color: white">
<iframe id="dictionary" src="https://www.mdbg.net/chinese/dictionary" frameBoarder="0" height="300" width="556"></iframe><br>

<button class="node" id='btnTranslate' onclick="{chat_Translate()}">翻译：TRANSLATE_☐</button>
<button class="node" id='btnSpeak'>收音：AUDIO_☐</button>
<br><select id='voiceList'></select><br>

<textarea id="userPrompt" style="background-color: black; color: white" rows="11" cols="82" name="comment" placeholder="Examine [...]"></textarea><br>

<select name="yandex" id="translate-list">
    <option value='en-zh'>English-to-汉语 : [en-zh]</option>
    <option value='en-de'>English-to-Deutsch : [en-de]</option>
    <option value='zh-en'>汉语-to-English : [zh-en]</option>
    <option value='zh-de'>汉语-to-Deutsch : [zh-de]</option>
    <option value='de-en'>Deutsch-to-English : [de-en]</option>
    <option value='de-zh'>Deutsch-to-Chinese : [de-zh]</option>
</select> : <sub style="color:yellow">["lang"]</sub>
<br>
<!--formerly {chat_Response()}-->
<button id="send" onclick="{config()}">送：SEND_☐</button>
<button class="node" id="instance" onclick="{inst_Prompt()}">对答：RESP_☐</button>
<button class="node" id="mod_Window" onclick="{expand()}">音译：EXPAND_☐</button>

<div id='keyboard_RU'>
<!-- Need Placement-->
<button id='I-alt' value='Ы' onclick="{keystroke_BTN('I-alt')}">Ы</button>
<!--"ih*" @Alt + "[I]"-->
<button id='Y-alt' value='И' onclick="{keystroke_BTN('Y-alt')}">И</button>
<!--"ee (long)" @Alt + "[Y]"-->
<button id='E-alt' value='Э' onclick="{keystroke_BTN('E-alt')}">Э</button>
<!--EN:"ae" @Alt = "[E]"-->
<button id='X-alt' value='Ч' onclick="{keystroke_BTN('X-alt')}">Ч</button>
<!--"ch"- @Alt + "[X]"-->

<br><br> 

<button id='tilde-key' value='Ё' onclick="{keystroke_BTN('tilde-key')}">Ё</button>
<!--"yo" @Symbol = "[~]"-->
<button id='Q-key' value='Ц' onclick="{keystroke_BTN('Q-key')}">Ц</button>
<!--"ts" @Alt + "[T][S]"-->
<button id='W-key' value='Ш' onclick="{keystroke_BTN('W-key')}">Ш</button>
<!--"sh" @Alt + "[S][H]"-->
<button id='E-key' value='Е' onclick="{keystroke_BTN('E-key')}">Е</button>
<!--EN:"e" @RU_Phonetic = "[E]"-->
<button id='R-key' value='Р' onclick="{keystroke_BTN('R-key')}">Р</button>
<!--"r" @RU_Phonetic = "[R]"-->
<button id='T-key' value='Т' onclick="{keystroke_BTN('T-key')}">Т</button>
<!--EN:"t" @Symbol = "[T]"-->
<button id='Y-key' value='У' onclick="{keystroke_BTN('Y-key')}">У</button>
<!--"oo" @Symbol = "[Y]"-->
<button id='U-key' value='Ю' onclick="{keystroke_BTN('U-key')}">Ю</button>
<!--"u" @RU_Phonetic = "[U]"-->
<button id='I-key' value='Й' onclick="{keystroke_BTN('I-key')}">Й</button>
<!--"y (short i)" @RU_Phonetic = "[I]"-->
<button id='O-key' value='О' onclick="{keystroke_BTN('O-key')}">О</button>
<!--EN:"o" @RU_Phonetic = "[O]"-->
<button id='P-key' value='П' onclick="{keystroke_BTN('P-key')}">П</button>
<!--"p" @Alt + "[P]"--><br>

<!--  -->
<button id='Shift-Key' value='Shift' onclick="{shift()}">Shift</button>

<!--  -->
<button id='A-key' value='А' onclick="{keystroke_BTN('A-key')}">А</button>
<!--EN:"a" @RU_Phonetic = "[A]"-->
<button id='S-key' value='Ж' onclick="{keystroke_BTN('S-key')}">Ж</button>
<!--"s" @RU_Phonetic = "[S]"-->
<button id='D-key' value='Д' onclick="{keystroke_BTN('D-key')}">Д</button>
<!--"d" @RU_Phonetic = "[D]"-->
<button id='F-key' value='Ф' onclick="{keystroke_BTN('F-key')}">Ф</button>
<!--"f" @RU_Phonetic = "[F]"-->
<button id='G-key' value='Г' onclick="{keystroke_BTN('G-key')}">Г</button>
<!--"g" @RU_Phonetic = "[G]"-->
<button id='H-key' value='Я' onclick="{keystroke_BTN('H-key')}">Я</button>
<!--*"ih [ya]" @RU_Phonetic = "[H]"-->
<button id='J-key' value='Щ' onclick="{keystroke_BTN('J-key')}">Щ</button>
<!--"shch" @Alt + "[S][H][C][H]"-->
<button id='K-key' value='К' onclick="{keystroke_BTN('K-key')}">К</button>
<!--EN:"k" @RU_Phonetic = "[K]"-->
<button id='L-key' value='Л' onclick="{keystroke_BTN('L-key')}">Л</button>
<!--"l" @RU_Phonetic = "[L]"-->
<input type="button" id="Enter-key" value="ENTER"><br>

<!-- -->
<input type="button" id='CMND-key' value="*CMND*" onclick="CMND_select()">
<button id='Alt-Key' value='AltLeft' onclick="{alt()}">Alt</button>

<!-- -->
<button id='Z-key' value='З' onclick="{keystroke_BTN('Z-key')}">З</button>
<!--"z" @RU_Phonetic = "[Z]"-->
<button id='X-key' value='Х' onclick="{keystroke_BTN('X-key')}">Х</button>
<!--"ch" @Symbol = "[X]"-->
<button id='C-key' value='С' onclick="{keystroke_BTN('C-key')}">С</button>
<!--EN:"c" @identical key-->
<button id='V-key' value='В' onclick="{keystroke_BTN('V-key')}">В</button>
<!--"v" @RU_Phonetic = "[V]"-->
<button id='B-key' value='Б' onclick="{keystroke_BTN('B-key')}">Б</button>
<!--EN:"b" @RU_Phonetic = "[B]"-->
<button id='N-key' value='Н' onclick="{keystroke_BTN('N-key')}">Н</button>
<!--"n" @RU_Phonetic = "[N]"-->
<button id='M-key' value='М' onclick="{keystroke_BTN('M-key')}">М</button>
<!--EN:"m" @RU_Phonetic = "[M]"-->
<button id='leftArrow-alt' value='Ь' onclick="{keystroke_BTN('Space-alt')}">Ь</button>
<!-- "silent(soft)" @Alt + "[comma]"-->
<button id='rightArrow-alt' value='Ъ' onclick="{keystroke_BTN('rightArrow-alt')}">Ъ</button>
<!--"silent(hard)" @Alt + "[period]"--><br>
</div>
<br><p id='console'></p>
<br><p id='translate_log'></p>
<br><p id='transcript'></p>
<p>Dev.Jaghund [Version 1.0.0]<br>Command_Terminal:
    <br> <r id="source" style="color:yellow">Source:\@dev.jaghund\汉字台式机〜P.C.》</r></p><br>
<div id="terminal">
    <div class="tsl" id="terminal-content">
    <br>
        <!--<p>Click '搜索: Search' to review (Random) Possessive:</p>-->
        <!--<sub id="toolbar">Menu [Window]: Options [droplist]: Close [x]:</sub>-->
        <!--<p id="search_Case0"></p>-->
        <div class="result" id="button_Case0"></div>
        <br>
        <!--<p id="search_Case1"></p>-->
        <div class="result" id="button_Case1"></div>
        <br>
        <!--<p id="search_Case2"></p>-->
        <div class="result" id="button_Case2"></div>
        <br>
        <!--<p id="search_Case3"></p>-->
        <div class="result" id="button_Case3"></div>
        <br>
        <!--<p id="search_Case4"></p>-->
        <div class="result" id="button_Case4">
        <br>
        </div>
        <!--Place idleCommand w/ DIV-->
        <image id="prompt" width="12" height="18" src="idleCommand.gif" style="position:relative; top:3px;"></image>
    <br>
</div>
<!--https://ipinfo.info/html/ip_checker.php-->
<a id="topic_link" href="" target="_blank">
<p id="topic_ip"></p>
</a>
<p id="topic_loc"></p>
    
<a id="topic00_link" href="" target="_blank">
<p id="topic00_ip"></p>
</a>
<p id="topic00_loc"></p>
    
<a id="topic01_link" href="" target="_blank">
<p id="topic01_ip"></p>
</a>
<p id="topic01_loc"></p>
<br><br>
<!--⎗ ⎘ ⏎ 🛈 🕪-->
<hr>
<script>
window.onload = function() {
    flash_c();
    accessData();
}
</script>
<br>
<sup>Use <strong>L-ALT</strong> on keyboard to re-suffle.</sup><br>
<strong id="flashcard" style="font-size:250%">...</strong><br>
<sup id="dialog"></sup><br>
<button id="empty" onclick="flash_c()" onkeydown="if (event.keyCode == 18){flash_c()}">开始：Begin</button><br>
<br><p id="manual"></p>

<!--<script>
//32KB (max) subject matter; obj. size limit.
/*General memory allocation allows for total of six(6) 汉字 references；
These instances are linked to specific web-search material which can further assist the user in language studies.*/
/*"Narrow" scope allows for more focused subject material review - however; ALL sessionData is linked to user-input access by-way-of the end user's native language.*/-->


<br>
<!--<button onclick = "submit()">ENTER</button>
<input id="user-input" type="text; reset" onkeydown="if (event.keyCode == 13) {submit()}">-->
<br>
<sup id="dialog"></sup>
<div>
<p id="compile"></p>
</div>
<button class="node" id="output" onclick="accessData()">[...]</button>
<button class="node" onclick="{collapse()}">网上：EXPAND_☐</button>
<br>
<sub>Conducting 【 搜索: Search 】reloads 'application' content.</sub>
<p id="log"></p>
<p id="language"></p>
<br>
<sub id="commandPrompt"></sub>
<p id="commandLog"></p>
<hr>





<!--<div id="info">
  <p id="info_start">点击“麦克风”的图标为了兴办录音：</p>
  <p id="info_speak_now">现在说话</p>
  <p id="info_no_speech">没有发言或不可能检波出来的、 调试
    <a href="//support.google.com/chrome/bin/answer.py?hl=en&amp;answer=1407892">
      麦克风设定</a>.</p>
  <p id="info_no_microphone" style="display:none">
    麦克风没有发现了
    <a href="//support.google.com/chrome/bin/answer.py?hl=en&amp;answer=1407892">
    麦克风设定</a>请检查麦克风设定的位形</p>
  <p id="info_allow">点击 "Allow" 为了启用麦克风</p>
  <p id="info_denied">“允准”使用麦克风是否定了</p>
  <p id="info_blocked">“允准”使用麦克风是阻止了，为了更去：chrome://settings/contentExceptions#media-stream</p>
  <p id="info_upgrade">不支持这网络浏览器'Web Speech API' 
     更新<a href="//www.google.com/chrome">Chrome</a>
     修订版25或后面</p>
</div>
<div class="right">
  <button class="node" id="start_button" onclick="startButton(event)"><img id="start_img" src="mic.gif" alt="Start"></button>
</div>
<div id="results">
  <span id="final_span" class="final"></span>
  <span id="interim_span" class="interim"></span>
  <p>
</div>
<div class="center">
  <div class="sidebyside" style="text-align:left">
    <!--<button id="copy_button" class="button" onclick="copyButton()">
      Copy and Paste</button>
    <div id="copy_info" class="info">
    </div>
  </div>
  <div class="sidebyside">
    <button id="email_button" class="button" onclick="emailButton()">
      Create Email</button>
    <div id="email_info" class="info">
      Text sent to default email application.<br>
      (See chrome://settings/handlers to change.)
    </div>
  </div>
  <p>
  <div id="div_language">
    <select id="select_language" onchange="updateCountry()"></select>
    &nbsp;&nbsp;
    <select id="select_dialect"></select>
  </div>
</div>
<hr>
<!--<img id="media" src="ani_active.gif" width="185" height="215" alt="李浩然">53 cols-->

<br>
<!--<iframe id="dictionary" src="https://www.mdbg.net/chinese/dictionary" frameBoarder="0" height="300" width="556"></iframe>-->




    
<!--<srcipt src='Google_API\tts-lang.js' type ='text/javascript'></srcipt>-->



<!--(mod) Window -->
<div id="chat_Resp" class="modal-tsl">

  <!-- Modal content -->
<div class="modal-content-tsl">
<div class="modal-header-tsl">
    <span class="close">&times;</span>
        <!--<div id="div_language">
        <select id="select_language" onchange="updateCountry()"></select>
    &nbsp;&nbsp;
        <select id="select_dialect"></select>
        </div>-->
</div>
<div class="modal-body-tsl">
      
    <div style="height:385px;width:100%;border:1px invisible;padding: 5px;overflow:auto;">
    
    <p id='chatLog'></p>
    </div>
</div>

<div class="modal-footer-tsl">
    <button onclick="chat_Response()">ENTER</button>
    <input id="userInput" type="text; reset" onkeydown="if (event.keyCode == 13) {chat_Response()}">
    
</div>
</div>
</div>

<script>
var audio = document.querySelector('#userPrompt'); 
var voiceList = document.querySelector('#voiceList');
var btnSpeak = document.querySelector('#btnSpeak');
var synth = window.speechSynthesis;
var voices = [];

PopulateVoices();
    if(speechSynthesis !== undefined){
        speechSynthesis.onvoiceschanged = PopulateVoices;
    }

    btnSpeak.addEventListener('click', ()=> {
        var toSpeak = new SpeechSynthesisUtterance(audio.value);
        var selectedVoiceName = voiceList.selectedOptions[0].getAttribute('data-name');
        voices.forEach((voice)=>{
            if(voice.name === selectedVoiceName){
                toSpeak.voice = voice;
            }
        });
            
        window.speechSynthesis.cancel();
        synth.speak(toSpeak);
        
    });

function PopulateVoices(){
    voices = synth.getVoices();
    var selectedIndex = voiceList.selectedIndex < 0 ? 0 :       voiceList.selectedIndex;
    voiceList.innerHTML = '';
    voices.forEach((voice)=>{
        var listItem = document.createElement('option');
        listItem.textContent = voice.name;
        listItem.setAttribute('data-lang', voice.lang);
        listItem.setAttribute('data-name', voice.name);
        voiceList.appendChild(listItem);
    });
    
    voiceList.selectedIndex = selectedIndex;
}
</script>
<!--<script>
var langs =
[['Afrikaans',       ['af-ZA']],
 ['Bahasa Indonesia',['id-ID']],
 ['Bahasa Melayu',   ['ms-MY']],
 ['Català',          ['ca-ES']],
 ['Čeština',         ['cs-CZ']],
 ['Deutsch',         ['de-DE']],
 ['English',         ['en-AU', 'Australia'],
                     ['en-CA', 'Canada'],
                     ['en-IN', 'India'],
                     ['en-NZ', 'New Zealand'],
                     ['en-ZA', 'South Africa'],
                     ['en-GB', 'United Kingdom'],
                     ['en-US', 'United States']],
 ['Español',         ['es-AR', 'Argentina'],
                     ['es-BO', 'Bolivia'],
                     ['es-CL', 'Chile'],
                     ['es-CO', 'Colombia'],
                     ['es-CR', 'Costa Rica'],
                     ['es-EC', 'Ecuador'],
                     ['es-SV', 'El Salvador'],
                     ['es-ES', 'España'],
                     ['es-US', 'Estados Unidos'],
                     ['es-GT', 'Guatemala'],
                     ['es-HN', 'Honduras'],
                     ['es-MX', 'México'],
                     ['es-NI', 'Nicaragua'],
                     ['es-PA', 'Panamá'],
                     ['es-PY', 'Paraguay'],
                     ['es-PE', 'Perú'],
                     ['es-PR', 'Puerto Rico'],
                     ['es-DO', 'República Dominicana'],
                     ['es-UY', 'Uruguay'],
                     ['es-VE', 'Venezuela']],
 ['Euskara',         ['eu-ES']],
 ['Français',        ['fr-FR']],
 ['Galego',          ['gl-ES']],
 ['Hrvatski',        ['hr_HR']],
 ['IsiZulu',         ['zu-ZA']],
 ['Íslenska',        ['is-IS']],
 ['Italiano',        ['it-IT', 'Italia'],
                     ['it-CH', 'Svizzera']],
 ['Magyar',          ['hu-HU']],
 ['Nederlands',      ['nl-NL']],
 ['Norsk bokmål',    ['nb-NO']],
 ['Polski',          ['pl-PL']],
 ['Português',       ['pt-BR', 'Brasil'],
                     ['pt-PT', 'Portugal']],
 ['Română',          ['ro-RO']],
 ['Slovenčina',      ['sk-SK']],
 ['Suomi',           ['fi-FI']],
 ['Svenska',         ['sv-SE']],
 ['Türkçe',          ['tr-TR']],
 ['български',       ['bg-BG']],
 ['Pусский',         ['ru-RU']],
 ['Српски',          ['sr-RS']],
 ['한국어',            ['ko-KR']],
 ['中文',             ['cmn-Hans-CN', '普通话 (中国大陆)'],
                     ['cmn-Hans-HK', '普通话 (香港)'],
                     ['cmn-Hant-TW', '中文 (台灣)'],
                     ['yue-Hant-HK', '粵語 (香港)']],
 ['日本語',           ['ja-JP']],
 ['Lingua latīna',   ['la']]];

for (var i = 0; i < langs.length; i++) {
  select_language.options[i] = new Option(langs[i][0], i);
}
select_language.selectedIndex = 6;
updateCountry();
select_dialect.selectedIndex = 6;
showInfo('info_start');

function updateCountry() {
  for (var i = select_dialect.options.length - 1; i >= 0; i--) {
    select_dialect.remove(i);
  }
  var list = langs[select_language.selectedIndex];
  for (var i = 1; i < list.length; i++) {
    select_dialect.options.add(new Option(list[i][1], list[i][0]));
  }
  select_dialect.style.visibility = list[1].length == 1 ? 'hidden' : 'visible';
}

//var create_email = false;
var final_transcript = '';
var recognizing = false;
var ignore_onend;
var start_timestamp;
if (!('webkitSpeechRecognition' in window)) {
  upgrade();
} else {
  //start_button.style.display = 'inline-block';
  var recognition = new webkitSpeechRecognition();
  recognition.continuous = true;
  recognition.interimResults = true;

  recognition.onstart = function() {
    recognizing = true;
    showInfo('info_speak_now');
    start_img.src = 'mic-animate.gif';
  };

  recognition.onerror = function(event) {
    if (event.error == 'no-speech') {
      start_img.src = 'mic.gif';
      showInfo('info_no_speech');
      ignore_onend = true;
    }
    if (event.error == 'audio-capture') {
      start_img.src = 'mic.gif';
      showInfo('info_no_microphone');
      ignore_onend = true;
    }
    if (event.error == 'not-allowed') {
      if (event.timeStamp - start_timestamp < 100) {
        showInfo('info_blocked');
      } else {
        showInfo('info_denied');
      }
      ignore_onend = true;
    }
  };

  recognition.onend = function() {
    recognizing = false;
    if (ignore_onend) {
      return;
    }
    start_img.src = 'mic.gif';
    if (!final_transcript) {
      showInfo('info_start');
      return;
    }
    showInfo('');
    if (window.getSelection) {
      window.getSelection().removeAllRanges();
      var range = document.createRange();
      range.selectNode(document.getElementById('final_span'));
      window.getSelection().addRange(range);
    }
    /*if (create_email) {
      create_email = false;
      createEmail();
    }*/
  };

  recognition.onresult = function(event) {
    var interim_transcript = '';
    for (var i = event.resultIndex; i < event.results.length; ++i) {
      if (event.results[i].isFinal) {
        final_transcript += event.results[i][0].transcript;
      } else {
        interim_transcript += event.results[i][0].transcript;
      }
    }
    final_transcript = capitalize(final_transcript);
    final_span.innerHTML = linebreak(final_transcript);
    interim_span.innerHTML = linebreak(interim_transcript);
    if (final_transcript || interim_transcript) {
      showButtons('inline-block');
    }
  };
}

function upgrade() {
  start_button.style.visibility = 'hidden';
  showInfo('info_upgrade');
}

var two_line = /\n\n/g;
var one_line = /\n/g;
function linebreak(s) {
  return s.replace(two_line, '<p></p>').replace(one_line, '<br>');
}

var first_char = /\S/;
function capitalize(s) {
  return s.replace(first_char, function(m) { return m.toUpperCase(); });
}

/*function createEmail() {
  var n = final_transcript.indexOf('\n');
  if (n < 0 || n >= 80) {
    n = 40 + final_transcript.substring(40).indexOf(' ');
  }
  var subject = encodeURI(final_transcript.substring(0, n));
  var body = encodeURI(final_transcript.substring(n + 1));
  window.location.href = 'mailto:?subject=' + subject + '&body=' + body;
}*/

/*function copyButton() {
  if (recognizing) {
    recognizing = false;
    recognition.stop();
  }
  copy_button.style.display = 'none';
  copy_info.style.display = 'inline-block';
  showInfo('');
}*/

/*function emailButton() {
  if (recognizing) {
    create_email = true;
    recognizing = false;
    recognition.stop();
  } else {
    createEmail();
  }
  email_button.style.display = 'none';
  email_info.style.display = 'inline-block';
  showInfo('');
}*/

function startButton(event) {
  if (recognizing) {
    recognition.stop();
    return;
  }
  final_transcript = '';
  recognition.lang = select_dialect.value;
  recognition.start();
  ignore_onend = false;
  final_span.innerHTML = '';
  interim_span.innerHTML = '';
  start_img.src = 'mic-slash.gif';
  showInfo('info_allow');
  showButtons('none');
  start_timestamp = event.timeStamp;
}

function showInfo(s) {
  if (s) {
    for (var child = info.firstChild; child; child = child.nextSibling) {
      if (child.style) {
        child.style.display = child.id == s ? 'inline' : 'none';
      }
    }
    info.style.visibility = 'visible';
  } else {
    info.style.visibility = 'hidden';
  }
}

var current_style;
function showButtons(style) {
  if (style == current_style) {
    return;
  }
  current_style = style;
  //copy_button.style.display = style;
  //email_button.style.display = style;
  //copy_info.style.display = 'none';
  //email_info.style.display = 'none';
}
</script>-->
<script>
// Get the modal
var modal = document.getElementById("chat_Resp");

// Get the button that opens the modal
var btn = document.getElementById("mod_Window"); //RESP_[]

// Get the <span> element that closes the modal
var span = document.getElementsByClassName("close")[0];

// When the user clicks the button, open the modal 
btn.onclick = function() {
  modal.style.display = "block";
}

// When the user clicks on <span> (x), close the modal
span.onclick = function() {
  modal.style.display = "none";
  
}

// When the user clicks anywhere outside of the modal, close it
window.onclick = function(event) {
  if (event.target == modal) {
    modal.style.display = "none";
  }
}
</script>


</body>
</html>